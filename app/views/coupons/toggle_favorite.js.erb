$("#toggle_favorite_<%= @coupon.id %>").tooltip('hide');
<%- if @refer_controller != "users" %>
  <%- if current_user.coupon_ids.include?(@coupon.id) %>
    $("#toggle_favorite_<%= @coupon.id %>").replaceWith("<a class='btn btn-default btn-xs fav_toggle'"
          + "container='body' data-placement='left' data-toggle='tooltip' title data-original-title='remove from favorite'"
          + "data-method='post' data-remote='true' href='/coupons/<%= @coupon.id %>/toggle_favorite?coupon_id=<%= @coupon.id %>'"
          + "trigger='hover' id='toggle_favorite_<%= @coupon.id %>' rel='nofollow'>"
          + "<span class='glyphicon glyphicon-heart'></span>"
          + "</a>");
    $("#toggle_favorite_<%= @coupon.id %>").tooltip('toggle');
  <%- else %>
    $("#toggle_favorite_<%= @coupon.id %>").replaceWith("<a class='btn btn-default btn-xs fav_toggle'" 
          + "container='body' data-placement='left' data-toggle='tooltip' title data-original-title='add to favorite'"
          + "data-method='post' data-remote='true' href='/coupons/<%= @coupon.id %>/toggle_favorite?coupon_id=<%= @coupon.id %>'"
          + "trigger='hover' id='toggle_favorite_<%= @coupon.id %>' rel='nofollow'>"
          + "<span class='glyphicon glyphicon-heart-empty'></span>"
          + "</a>");
    $("#toggle_favorite_<%= @coupon.id %>").tooltip('toggle');
  <%- end %>
<%- else %>
  $("#coupon_<%= @coupon.id %>").hide("slow")
<%- end %>